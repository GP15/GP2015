- provide(:title, "Payment")
- provide(:nav_color, "link-white")
- provide(:page_title_bg, asset_path('page-bg-child.jpg'))
.content.subscribe-page
  = render partial: 'layouts/page_title', locals: { page_title: 'Payment' }
  = render 'shared/notice' if flash.present?

  .container
    .content-main
      %h3 Select Your Plan
      .package-pricing-table-container

        - plan = SubscriptionType.amateur
        .package-pricing-table
          .package-pricing-title
            = plan.name
          .package-pricing-price
            %span.package-pricing-currency RM
            %span.package-pricing-number
              = plan.price
            %span.package-pricing-subtitle Per Month
            %span.package-pricing-details
              = "#{plan.activities_allowed} Activities Per Month"
          .package-pricing-content
            %p We make it really simple for you:
            %ul
              %li
                %i.fa.fa-check
                Auto Renewal
              %li
                %i.fa.fa-check
                No Contract
              %li
                %i.fa.fa-check
                No Termination Fee
              %li
                %i.fa.fa-check
                Cancel Anytime
          .package-pricing-action
            .gp-link{ :data => { :toggle => "collapse"},
                      :href => "#package-promocode-amateur",
                      :title => "Got Promo Code?"}
              Got Promo Code?
            #package-promocode-amateur.package-promo-code.collapse
              .promo_code_plan
                = render :partial => "users/referal_code_form"

            %button.gp-button.open-modal{ :href => "#",
                                          :title => "Select Plan",
                                          :data =>  { :target => "#package-subscription",
                                                      :toggle => "modal",
                                                      :id => "RM79",
                                                      :promocode => "",
                                                      :subscription_type_id => "#{plan.id}"}  } Select Plan

        .package-pricing-table.featured
          - plan = SubscriptionType.pro
          .package-pricing-title
            = plan.name
          .package-pricing-price
            %span.package-pricing-currency RM
            %span.package-pricing-number
              = plan.price
            %span.package-pricing-subtitle Per Month
            %span.package-pricing-details Unlimited Activities Per Month
          .package-pricing-content
            %p We make it really simple for you:
            %ul
              %li
                %i.fa.fa-check
                Auto Renewal
              %li
                %i.fa.fa-check
                No Contract
              %li
                %i.fa.fa-check
                No Termination Fee
              %li
                %i.fa.fa-check
                Cancel Anytime
          .package-pricing-action
            .gp-link{ :data => {:toggle => "collapse"},
                      :href => "#package-promocode-pro",
                      :title => "Got Promo Code?"} Got Promo Code?
            #package-promocode-pro.package-promo-code.collapse
              .promo_code_plan
                = render :partial => "users/referal_code_form"
            %button.gp-button.open-modal{ :href => "#",
                                          :title => "Select Plan",
                                          :data =>  { :target => "#package-subscription",
                                                      :toggle => "modal",
                                                      :id => "RM79",
                                                      :promocode => "",
                                                      :subscription_type_id => "#{plan.id}"}  } Select Plan

      %p.basic-package-link
        - plan = SubscriptionType.free
        = link_to "Try our Basic Package for FREE",
                  child_subscriptions_path( @child,
                    :subscription => { :subscription_type_id => plan.id }),
                  :method => :post,
                  :class => "gp-link"
        %span
          = "(#{plan.activities_allowed} Activity Per Month)"


#package-subscription.modal.fade{:role => "dialog", :tabindex => "-1"}
  .modal-dialog
    .modal-content
      .modal-header
        %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
          %span{"aria-hidden" => "true"} Ã—
        %h4.modal-title Subscribe Your Plan
      .modal-body
        = form_for(@subscription, url: child_subscriptions_path(@child)) do |f|
          .field
            = f.hidden_field :plan_id
            = f.hidden_field :promo_code
            = f.hidden_field :subscription_type_id
            #dropin
          = f.submit "Subscribe", class: "btn btn-success", :id => "suscribe_btn"
      .modal-footer
        %button.gp-button.default{"data-dismiss" => "modal", :type => "button"} Cancel


:javascript
  $(document).ready(function(){
    $(".open-modal").click(function() {
      var promo_code = $(this).data('promocode');
      var subscription_type_id = $(this).data('subscription-type-id')
      var planId = $(this).data('id');
      $("#subscription_plan_id").val( planId );
      $("#subscription_promo_code").val( promo_code);
      $("#subscription_subscription_type_id").val( subscription_type_id);
    });
  });

= content_for :javascript do
  = javascript_include_tag "https://js.braintreegateway.com/v2/braintree.js"
  :javascript
     var client_token = "#{@client_token}";
     braintree.setup(
       client_token,
       'dropin', {
         container: 'dropin',
         onReady: function(){ $("#suscribe_btn").prop('disabled', false); }
       });
